<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Architect v58 Mobile</title>
    <style>
        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --gold: #f1c40f;
            --green: #2ecc71;
            --red: #e74c3c;
            --cyan: #00e5ff;
            --pink: #ff0080;
            --text: #eee;
            --btn-h: 50px; /* Altura bot√£o */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg); color: var(--text);
            margin: 0; padding: 8px; text-align: center;
            user-select: none; -webkit-tap-highlight-color: transparent;
            overflow-x: hidden; padding-bottom: 80px;
        }

        /* HUD SUPERIOR */
        .hud {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
            margin-bottom: 10px;
        }

        .stat-card {
            background: var(--card); border: 1px solid #333; border-radius: 8px;
            padding: 8px; display: flex; flex-direction: column; justify-content: center;
            height: 50px; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .lbl { font-size: 0.6rem; color: #888; letter-spacing: 1px; text-transform: uppercase; }
        .val { font-size: 1.1rem; font-weight: 800; color: #fff; }
        .dist-val { color: var(--gold); }

        /* BARRA DE ALERTA */
        .alert-bar {
            background: #000; border: 1px solid #333; border-radius: 6px;
            padding: 12px; margin-bottom: 15px; font-size: 0.9rem; font-weight: bold; color: #666;
            min-height: 1.2em; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        
        /* Estados da Barra */
        .st-active { border-color: var(--gold); color: #fff; background: rgba(241, 196, 15, 0.1); }
        .st-rail   { border-color: var(--pink); color: var(--pink); background: rgba(255, 0, 128, 0.15); animation: pulse 0.5s infinite alternate; }
        .st-error  { border-color: var(--red); color: var(--red); background: rgba(255, 51, 51, 0.1); }

        @keyframes pulse { from { opacity: 0.8; } to { opacity: 1; } }

        /* GRID DE N√öMEROS */
        .grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;
            max-width: 100%; margin: 0 auto;
        }

        .num-btn {
            background: #252525; border: 1px solid #333; color: #888;
            height: var(--btn-h); border-radius: 6px;
            font-size: 1.2rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.05s;
        }
        .num-btn:active { transform: scale(0.95); background: #444; }
        .num-btn[data-n="0"] { grid-column: 1 / -1; color: #2ecc71; border-color: #145a32; }

        /* HIGHLIGHTS */
        .last-hit { background: #fff !important; color: #000 !important; z-index: 10; border-color: #fff !important; }
        
        .h-zone { background: rgba(241, 196, 15, 0.15) !important; color: var(--gold) !important; border: 1px solid var(--gold) !important; }
        .h-center { background: var(--gold) !important; color: #000 !important; border: 1px solid #fff !important; font-weight: 900; }
        
        .h-walk { background: var(--pink) !important; color: #fff !important; border: 1px solid #fff !important; }
        .h-ghost { border: 1px dashed var(--cyan) !important; color: var(--cyan) !important; }
        
        .overlap { background: var(--green) !important; color: #000 !important; border: 1px solid #fff !important; box-shadow: 0 0 15px var(--green); }

        /* BOTTOM BAR (CONTROLES) */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(15,15,15,0.95); backdrop-filter: blur(5px);
            border-top: 1px solid #333; padding: 10px 15px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            z-index: 100;
        }

        .ctrl-btn {
            background: #333; color: #ccc; border: none;
            padding: 12px; border-radius: 6px; font-weight: bold; font-size: 0.8rem;
        }
        .ctrl-btn:active { background: #555; color: #fff; }
        .btn-undo { background: #2c3e50; }
        .btn-reset { background: #c0392b; color: #fff; }

        /* SEQ INFO */
        .seq-info {
            position: fixed; bottom: 65px; left: 0; right: 0;
            text-align: center; font-size: 0.7rem; color: #555;
            pointer-events: none;
        }

    </style>
</head>
<body>

    <div class="hud">
        <div class="stat-card">
            <span class="lbl">STATUS</span>
            <span id="status-text" class="val" style="font-size:0.9rem">CALIBRANDO</span>
        </div>
        <div class="stat-card">
            <span class="lbl">ALVO EL√ÅSTICO</span>
            <span id="dist-val" class="val dist-val">--</span>
        </div>
    </div>

    <div id="pred-bar" class="alert-bar">AGUARDANDO DADOS...</div>

    <div class="grid" id="grid"></div>

    <div class="seq-info">
        Seq: <span id="seq-disp">-</span> | <span id="last-jump">-</span>
    </div>

    <div class="bottom-bar">
        <button class="ctrl-btn btn-undo" onclick="undo()">‚Ü© DESFAZER</button>
        <button class="ctrl-btn btn-reset" onclick="reset()">üóëÔ∏è RESETAR</button>
    </div>

    <script>
        const wheel = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const wheelIdx = {}; wheel.forEach((n,i)=>wheelIdx[n]=i);
        const ghosts = { 32:[24], 9:[36], 35:[23], 7:[25], 15:[15], 24:[33], 8:[4] };

        let history = [];
        let autoDist = null;
        let penaltyMode = false; 
        let activeZones = []; 

        const CALIB = 3;
        const TOLERANCE = 3; // Elastic
        const RANGE = 6; // Rede de 13

        const grid = document.getElementById('grid');
        createBtn(0);
        for(let i=1; i<=36; i++) createBtn(i);

        function createBtn(n) {
            let b = document.createElement('div');
            b.className = 'num-btn';
            b.innerText = n;
            b.dataset.n = n;
            b.onclick = () => input(n);
            grid.appendChild(b);
        }

        function input(n) {
            // Check Win
            if (activeZones.length > 0) {
                penaltyMode = !activeZones.includes(n);
                if(penaltyMode) autoDist = null;
            }

            // Update History
            if(history.length > 0) {
                let prev = history[history.length-1];
                let d = getAbsDist(n, prev);
                document.getElementById('last-jump').innerText = `Pulo: ¬±${d}`;
            }
            history.push(n);
            if(history.length > 12) history.shift();

            // Recalc
            if (penaltyMode) {
                let check = checkStabilityElastic();
                if (check !== null) { penaltyMode = false; autoDist = check; }
                else autoDist = null;
            } else {
                autoDist = checkStabilityElastic();
            }

            refreshUI(n);
        }

        function refreshUI(lastNum) {
            resetGrid();
            document.querySelector(`.num-btn[data-n="${lastNum}"]`).classList.add('last-hit');
            document.getElementById('seq-disp').innerText = history.slice(-3).join(', ');

            const status = document.getElementById('status-text');
            const dVal = document.getElementById('dist-val');
            const bar = document.getElementById('pred-bar');

            if(penaltyMode) {
                status.innerText = "ERRO - ESPERE"; status.style.color = "var(--red)";
                dVal.innerText = "‚ùå";
                bar.innerText = "PADR√ÉO QUEBRADO - RECALIBRANDO";
                bar.className = "alert-bar st-error";
                return;
            }

            dVal.innerText = autoDist !== null ? `¬±${autoDist}` : "--";
            activeZones = [];

            // 1. WALKING (Prioridade)
            if (checkWalking()) {
                status.innerText = "‚ö†Ô∏è TRILHO"; status.style.color = "var(--pink)";
                dVal.innerText = "VIZINHO";
                bar.innerText = "APOSTE NOS VIZINHOS (1-2 CASAS)";
                bar.className = "alert-bar st-rail";
                highlightZone(lastNum, 1, 'h-walk', 2);
                return;
            }

            // 2. CALIBRA√á√ÉO
            if (history.length <= CALIB) {
                status.innerText = `CALIBRANDO ${history.length}/3`; status.style.color = "#666";
                bar.innerText = "AGUARDANDO DADOS...";
                bar.className = "alert-bar";
                bar.style.borderColor = "#333";
                return;
            }

            // 3. REDE EL√ÅSTICA (Ativa)
            if (autoDist !== null) {
                status.innerText = "ATIVO"; status.style.color = "var(--gold)";
                bar.innerText = `ALVO DUPLO: ¬±${autoDist} (REDE 13)`;
                bar.className = "alert-bar st-active";
                
                let t1 = highlightZone(lastNum, autoDist, 'h-zone', RANGE);
                highlightCenter(t1);
                let t2 = highlightZone(lastNum, (37-autoDist)%37, 'h-zone', RANGE);
                highlightCenter(t2);
            } else {
                status.innerText = "INST√ÅVEL"; status.style.color = "#555";
                bar.innerText = "MESA VARI√ÅVEL - N√ÉO JOGUE";
                bar.className = "alert-bar";
                bar.style.borderColor = "#333";
            }

            // Ghost
            if(ghosts[lastNum]) ghosts[lastNum].forEach(g => {
                let b = document.querySelector(`.num-btn[data-n="${g}"]`);
                if(b.classList.contains('h-zone') || b.classList.contains('h-center')) b.className = 'num-btn overlap';
                else b.classList.add('h-ghost');
            });
        }

        function checkStabilityElastic() {
            if(history.length < 4) return null;
            let j = [];
            for(let i=history.length-1; i>history.length-4; i--) j.push(getAbsDist(history[i], history[i-1]));
            let avg = Math.round((j[0]+j[1]+j[2])/3);
            if (Math.abs(j[0]-avg)<=TOLERANCE && Math.abs(j[1]-avg)<=TOLERANCE && Math.abs(j[2]-avg)<=TOLERANCE) return avg;
            return null;
        }

        function checkWalking() {
            if(history.length < 3) return false;
            let p1 = getAbsDist(history[history.length-1], history[history.length-2]);
            let p2 = getAbsDist(history[history.length-2], history[history.length-3]);
            return (p1 <= 2) && (p2 <= 2);
        }

        function getAbsDist(n1, n2) {
            let d = Math.abs(wheelIdx[n1]-wheelIdx[n2]);
            return d > 18 ? 37 - d : d;
        }

        function highlightZone(n, offset, cls, w) {
            let idx = wheelIdx[n];
            let tIdx = (idx + offset) % 37;
            for(let i=-w; i<=w; i++) {
                let v = wheel[(tIdx+i+37)%37];
                let b = document.querySelector(`.num-btn[data-n="${v}"]`);
                if(!b.classList.contains('h-center') && !b.classList.contains('overlap')) b.classList.add(cls);
                activeZones.push(v);
            }
            return wheel[tIdx];
        }

        function highlightCenter(n) {
            let b = document.querySelector(`.num-btn[data-n="${n}"]`);
            if(!b.classList.contains('overlap')) b.classList.add('h-center');
        }

        function resetGrid() {
            document.querySelectorAll('.num-btn').forEach(b => {
                b.className = 'num-btn';
                if(b.dataset.n==0) b.style.color='#1e8449'; else b.style.color='#888';
            });
        }

        function undo() { history.pop(); penaltyMode=false; if(history.length) refreshUI(history[history.length-1]); else reset(); }
        function reset() { history=[]; autoDist=null; penaltyMode=false; activeZones=[]; resetGrid(); document.getElementById('status-text').innerText="RESET"; document.getElementById('dist-val').innerText="--"; document.getElementById('pred-bar').innerText="AGUARDANDO..."; }

    </script>
</body>
</html>